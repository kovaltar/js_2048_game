const t=new class{#t="idle";#e=[];#s=0;constructor(t){this.initialState=t||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.state=JSON.parse(JSON.stringify(this.initialState))}moveLeft(){for(let t=0;t<this.state.length;t++){let e=this.state[t],s=this.#i(this.#a(e)),i=!1;if(i=!this.#r(e,s),this.#e.push(i),i)for(let t=0;t<s.length;t++)e[t]=s[t]}this.#e.includes(!0)&&(this.#l(this.state),this.#e.length=0),this.#n()}moveRight(){for(let t=0;t<this.state.length;t++){let e=this.state[t],s=this.#h(this.#a(e)),i=!1;if(i=!this.#r(e,s),this.#e.push(i),i)for(let t=0;t<s.length;t++)e[t]=s[t]}this.#e.includes(!0)&&(this.#l(this.state),this.#e.length=0),this.#n()}moveUp(){for(let t=0;t<this.state.length;t++){let e=this.#o(this.state,t),s=this.#i(this.#a(e)),i=!1;if(i=!this.#r(e,s),this.#e.push(i),i)for(let e=0;e<s.length;e++)this.state[e][t]=s[e]}this.#e.includes(!0)&&(this.#l(this.state),this.#e.length=0),this.#n()}moveDown(){for(let t=0;t<this.state.length;t++){let e=this.#o(this.state,t),s=this.#h(this.#a(e)),i=!1;if(i=!this.#r(e,s),this.#e.push(i),i)for(let e=0;e<s.length;e++)this.state[e][t]=s[e]}this.#e.includes(!0)&&(this.#l(this.state),this.#e.length=0),this.#n()}getScore(){return this.#s}getState(){return this.state}getStatus(){return this.#t}start(){this.#n(),this.#l(this.state),this.#l(this.state)}restart(){this.#t="idle",this.state=JSON.parse(JSON.stringify(this.initialState)),this.#s=0}#u(t){let e=[];return t.flat().forEach((t,s,i)=>{0===t&&e.push(s)}),e}#g(t){let e=this.#u(t);if(e.length){let t=Math.floor(Math.random()*e.length),s=e[t];return[Math.floor(s/4),s%4]}}#l(t){if(this.#n(),"idle"===this.#t||"playing"===this.#t){let e=this.#g(t);1===Math.floor(1+10*Math.random())?t[e[0]][e[1]]=4:t[e[0]][e[1]]=2}}#a(t){return t.filter((t,e,s)=>0!==t)}#o(t,e){let s=[];for(let i=0;i<t.length;i++)s.push(t[i][e]);return s}#h(t){let e=t.concat(),s=[];for(let t=e.length-1;t>=0;t--)e[t]===e[t-1]?(e[t]*=2,this.#s+=e[t],s.push(e[t]),e.splice(e.length-2,2)):s.push(e.splice(t,1)[0]),t=e.length;if(s.length<4)for(let t=s.length;t<4;t++)s.push(0);return s.reverse(),s}#i(t){let e=t.concat(),s=[];for(let t=0;t<e.length;t++)e[t]===e[t+1]?(e[t]*=2,this.#s+=e[t],s.push(e[t]),e.splice(0,t+2)):s.push(e.splice(0,1)[0]),t-=1;if(s.length<4)for(let t=s.length;t<4;t++)s.push(0);return s}#r(t,e){return t.length===e.length&&t.every((t,s)=>t===e[s])}#c(t){return Math.max(...t.flat())}#d(t){if(t.flat().includes(0))return!0;for(let e=0;e<t.length;e++){let s=t[e],i=this.#o(t,e);if(this.#m(s)||this.#m(i))return!0}return!1}#m(t){return t.some((e,s,i)=>0!==s&&e===t[s-1])}#n(){return this.#r(this.initialState.flat(),this.state.flat())&&this.#d(this.state)&&2048>this.#c(this.state)?this.#t="idle":this.#c(this.state)>=2048?this.#t="win":!this.#d(this.state)&&2048>this.#c(this.state)?this.#t="lose":this.#t="playing",this.#t}},e=document.querySelector(".button.start"),s=document.querySelector(".game-score"),i=document.querySelectorAll(".field-cell");function a(t){let e=t.className.match(/(\d+)/g);return e?e[0]:0}function r(t){let e=document.querySelectorAll(".message");for(let s=0;s<e.length;s++){let i=e[s];i.classList.contains(`message-${t}`)?i.classList.contains("hidden")&&i.classList.remove("hidden"):i.classList.contains("hidden")||i.classList.add("hidden")}}function l(){for(let e=0;e<i.length;e++){let s=i[e],r=t.getState().flat()[e];r!==+s.innerHTML&&(0!==r?s.innerHTML=String(r):s.innerHTML=""),a(s)!==s.innerHTML&&(s.classList.remove(`field-cell--${a(s)}`),s.classList.add(`field-cell--${r}`))}switch(s.innerHTML=t.getScore(),t.getStatus()){case"win":case"lose":r(t.getStatus());break;case"idle":r("start");break;case"playing":r()}}function n(e){switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown()}l()}l(),e.addEventListener("click",function(){e.classList.contains("restart")?(document.removeEventListener("keydown",n),e.innerHTML="Start",e.classList.remove("restart"),t.restart()):(t.start(),document.addEventListener("keydown",n),"playing"===t.getStatus()&&(e.classList.add("restart"),e.innerHTML="Restart")),l()});
//# sourceMappingURL=index.509f5c6b.js.map
